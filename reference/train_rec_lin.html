<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Train a Record Linkage Model — train_rec_lin • automatedRecLin</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Train a Record Linkage Model — train_rec_lin"><meta name="description" content="Trains a supervised record linkage model using probability or density ratio estimation,
based on Lee et al. (2022),
with several extensions."><meta property="og:description" content="Trains a supervised record linkage model using probability or density ratio estimation,
based on Lee et al. (2022),
with several extensions."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">automatedRecLin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncn-foreigners/automatedRecLin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Train a Record Linkage Model</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/automatedRecLin/blob/main/R/supervised_learning.R" class="external-link"><code>R/supervised_learning.R</code></a></small>
      <div class="d-none name"><code>train_rec_lin.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Trains a supervised record linkage model using probability or density ratio estimation,
based on <a href="https://www150.statcan.gc.ca/n1/pub/12-001-x/2022001/article/00007-eng.htm" class="external-link">Lee et al. (2022)</a>,
with several extensions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">train_rec_lin</span><span class="op">(</span></span>
<span>  <span class="va">A</span>,</span>
<span>  <span class="va">B</span>,</span>
<span>  <span class="va">matches</span>,</span>
<span>  <span class="va">variables</span>,</span>
<span>  comparators <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  methods <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prob_ratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nonpar_hurdle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  controls_nleqslv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  controls_kliep <span class="op">=</span> <span class="fu"><a href="control_kliep.html">control_kliep</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-a">A<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>A duplicate-free <code>data.frame</code> or <code>data.table</code>.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>A duplicate-free <code>data.frame</code> or <code>data.table</code>.</p></dd>


<dt id="arg-matches">matches<a class="anchor" aria-label="anchor" href="#arg-matches"></a></dt>
<dd><p>A <code>data.frame</code> or <code>data.table</code> indicating known matches.</p></dd>


<dt id="arg-variables">variables<a class="anchor" aria-label="anchor" href="#arg-variables"></a></dt>
<dd><p>A character vector of key variables used to create comparison vectors.</p></dd>


<dt id="arg-comparators">comparators<a class="anchor" aria-label="anchor" href="#arg-comparators"></a></dt>
<dd><p>A named list of functions for comparing pairs of records.</p></dd>


<dt id="arg-methods">methods<a class="anchor" aria-label="anchor" href="#arg-methods"></a></dt>
<dd><p>A named list of methods used for estimation (<code>"binary"</code>, <code>"continuous_parametric"</code> or <code>"continuous_nonparametric"</code>).</p></dd>


<dt id="arg-prob-ratio">prob_ratio<a class="anchor" aria-label="anchor" href="#arg-prob-ratio"></a></dt>
<dd><p>Probability/density ratio type (<code>"1"</code> or <code>"2"</code>).</p></dd>


<dt id="arg-nonpar-hurdle">nonpar_hurdle<a class="anchor" aria-label="anchor" href="#arg-nonpar-hurdle"></a></dt>
<dd><p>Logical indicating whether to use a hurdle model or not
(used only if the <code>"continuous_nonparametric"</code> method has been chosen for at least one variable).</p></dd>


<dt id="arg-controls-nleqslv">controls_nleqslv<a class="anchor" aria-label="anchor" href="#arg-controls-nleqslv"></a></dt>
<dd><p>Controls passed to the <a href="https://rdrr.io/pkg/nleqslv/man/nleqslv.html" class="external-link">nleqslv</a> function (only if the <code>"continuous_parametric"</code> method has been chosen for at least one variable).</p></dd>


<dt id="arg-controls-kliep">controls_kliep<a class="anchor" aria-label="anchor" href="#arg-controls-kliep"></a></dt>
<dd><p>Controls passed to the <a href="https://thomvolker.github.io/densityratio/reference/kliep.html" class="external-link">kliep</a> function (only if the <code>"continuous_nonparametric"</code> method has been chosen for at least one variable).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list containing:<br></p><ul><li><p><code>b_vars</code> – a character vector of variables used for the <code>"binary"</code> method (with the prefix <code>"gamma_"</code>),</p></li>
<li><p><code>cpar_vars</code> – a character vector of variables used for the <code>"continuous_parametric"</code> method (with the prefix <code>"gamma_"</code>),</p></li>
<li><p><code>cnonpar_vars</code> – a character vector of variables used for the <code>"continuous_nonparametric"</code> method (with the prefix <code>"gamma_"</code>),</p></li>
<li><p><code>b_params</code> – parameters estimated using the <code>"binary"</code> method,</p></li>
<li><p><code>cpar_params</code> – parameters estimated using the <code>"continuous_parametric"</code> method,</p></li>
<li><p><code>cnonpar_params</code> – probability of exact matching estimated using the <code>"continuous_nonparametric"</code> method,</p></li>
<li><p><code>ratio_kliep</code> – a result of the <a href="https://thomvolker.github.io/densityratio/reference/kliep.html" class="external-link">kliep</a> function,</p></li>
<li><p><code>ratio_kliep_list</code> – an object containing the results of the <a href="https://thomvolker.github.io/densityratio/reference/kliep.html" class="external-link">kliep</a> function,</p></li>
<li><p><code>ml_model</code> – here <code>NULL</code>,</p></li>
<li><p><code>pi_est</code> – a prior probability of matching,</p></li>
<li><p><code>match_prop</code> – proportion of matches in the smaller dataset,</p></li>
<li><p><code>variables</code> – a character vector of key variables used for comparison,</p></li>
<li><p><code>comparators</code> – a list of functions used to compare pairs of records,</p></li>
<li><p><code>methods</code> – a list of methods used for estimation,</p></li>
<li><p><code>"prob_ratio"</code> – probability/density ratio type.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Consider two datasets: \(A\) and \(B\).
Let the bipartite comparison space \(\Omega = A \times B\) consist of
matches \(M\) and non-matches \(U\) between the records in files
\(A\) and \(B\). For any pair of records \((a,b) \in \Omega\),
let \(\pmb{\gamma}_{ab} = (\gamma_{ab}^1,\gamma_{ab}^2,
\ldots,\gamma_{ab}^K)'\) be the comparison vector between
a set of key variables. The original MEC algorithm uses the binary
comparison function to evaluate record pairs across two datasets.
However, this approach may be insufficient when handling datasets
with frequent errors across multiple variables.</p>
<p>We propose the use of continuous comparison functions to address
the limitations of binary comparison methods. We consider every
semi-metric, i.e., a function \(d: A \times B \to \mathbb{R}\),
satisfying the following conditions:<br></p><ol><li><p>\(d(x,y) \geq 0\),</p></li>
<li><p>\(d(x,y) = 0\) if and only if \(x = y\),</p></li>
<li><p>\(d(x,y) = d(y,x)\).</p></li>
</ol><p>For example, we can use \(1 - \text{Jaro-Winkler distance}\) for character variables
(which is implemented in the <code>automatedRecLin</code> package as the <code>jarowinkler_complement</code> function)
or the Euclidean distance for numerical variables. The <code>automatedRecLin</code> package allows the use of
a different comparison function for each key variable (which should be specified
as a list in the <code>comparators</code> argument). The default function
for each key variable is <a href="https://rdrr.io/pkg/reclin2/man/comparators.html" class="external-link">cmp_identical</a>
(the binary comparison function).</p>
<p>The <code>train_rec_lin</code> function is used to train a record linkage model,
when \(M\) and \(U\) are known (which might later serve as a classifier
for pairs outside \(\Omega\)). It offers different approaches to estimate the
probability/density ratio between matches and non-matches, which should be
specified as a list in the methods argument. The method suitable for the binary
comparison function is <code>"binary"</code>, which is also the default method for each
variable.</p>
<p>For the continuous semi-metrics we suggest the usage
of <code>"continuous_parametric"</code> or <code>"continuous_nonparametric"</code>
method. The <code>"continuous_parametric"</code> method assumes that
\(\gamma_{ab}^k|M\) and \(\gamma_{ab}^k|U\) follow
hurdle Gamma distributions. The density function of a hurdle
Gamma distribution is characterized by three parameters
\(p_0 \in (0,1)\) and \(\alpha, \beta &gt; 0\) as follows:
$$
f(x;p_0,\alpha,\beta) = p_0^{\mathbb{I}(x = 0)}[(1 - p_0) v(x;\alpha,\beta)]^{\mathbb{I}(x &gt; 0)},
$$
where
$$
v(x;\alpha,\beta) = \frac{\beta^{\alpha} x^{\alpha - 1} \exp(-\beta x)}
{\Gamma(\alpha)}
$$
is the density function of a Gamma distribution
(for details see <a href="https://ideas.repec.org/a/eee/csdana/v179y2023ics0167947322002365.html" class="external-link">Vo et al. (2023)</a>).
The <code>"continuous_nonparametric"</code> method does not assume anything about
the distributions of the comparison vectors. It directly
estimates the density ratio between the matches and the non-matches, using
the Kullback-Leibler Importance Estimation Procedure (KLIEP).
For details see <a href="https://link.springer.com/article/10.1007/s10463-008-0197-x" class="external-link">Sugiyama et al. (2008)</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Lee, D., Zhang, L.-C. and Kim, J. K. (2022). Maximum entropy classification for record linkage.
Survey Methodology, Statistics Canada, Catalogue No. 12-001-X, Vol. 48, No. 1.</p>
<p>Vo, T. H., Chauvet, G., Happe, A., Oger, E., Paquelet, S., and Garès, V. (2023).
Extending the Fellegi-Sunter record linkage model for mixed-type data with application to the French national health data system.
Computational Statistics &amp; Data Analysis, 179, 107656.</p>
<p>Sugiyama, M., Suzuki, T., Nakajima, S. et al. Direct importance estimation for covariate shift adaptation.
Ann Inst Stat Math 60, 699–746 (2008). <a href="https://doi.org/10.1007/s10463-008-0197-x" class="external-link">doi:10.1007/s10463-008-0197-x</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Adam Struzik</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"name"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"James"</span>, <span class="st">"Emma"</span>, <span class="st">"William"</span>, <span class="st">"Olivia"</span>, <span class="st">"Thomas"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Sophie"</span>, <span class="st">"Harry"</span>, <span class="st">"Amelia"</span>, <span class="st">"George"</span>, <span class="st">"Isabella"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"surname"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Smith"</span>, <span class="st">"Johnson"</span>, <span class="st">"Brown"</span>, <span class="st">"Taylor"</span>, <span class="st">"Wilson"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Davis"</span>, <span class="st">"Clark"</span>, <span class="st">"Harris"</span>, <span class="st">"Lewis"</span>, <span class="st">"Walker"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"name"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"James"</span>, <span class="st">"Ema"</span>, <span class="st">"Wimliam"</span>, <span class="st">"Olivia"</span>, <span class="st">"Charlotte"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Henry"</span>, <span class="st">"Lucy"</span>, <span class="st">"Edward"</span>, <span class="st">"Alice"</span>, <span class="st">"Jack"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"surname"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Smith"</span>, <span class="st">"Johnson"</span>, <span class="st">"Bron"</span>, <span class="st">"Tailor"</span>, <span class="st">"Moore"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Evans"</span>, <span class="st">"Hall"</span>, <span class="st">"Wright"</span>, <span class="st">"Green"</span>, <span class="st">"King"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">comparators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"name"</span> <span class="op">=</span> <span class="fu"><a href="jarowinkler_complement.html">jarowinkler_complement</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    <span class="st">"surname"</span> <span class="op">=</span> <span class="fu"><a href="jarowinkler_complement.html">jarowinkler_complement</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"b"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"name"</span> <span class="op">=</span> <span class="st">"continuous_nonparametric"</span>,</span></span>
<span class="r-in"><span>                <span class="st">"surname"</span> <span class="op">=</span> <span class="st">"continuous_nonparametric"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">train_rec_lin</span><span class="op">(</span>A <span class="op">=</span> <span class="va">df_1</span>, B <span class="op">=</span> <span class="va">df_2</span>, matches <span class="op">=</span> <span class="va">matches</span>,</span></span>
<span class="r-in"><span>                       variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"surname"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       comparators <span class="op">=</span> <span class="va">comparators</span>,</span></span>
<span class="r-in"><span>                       methods <span class="op">=</span> <span class="va">methods</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There are duplicate values in 'sigma', only the unique values are used.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There are duplicate values in 'sigma', only the unique values are used.</span>
<span class="r-in"><span><span class="va">model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Record linkage model based on the following variables: name, surname.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The prior probability of matching is 0.04.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variables selected for the continuous nonparametric method: name, surname.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Probability/density ratio type: 1.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam Struzik, Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

